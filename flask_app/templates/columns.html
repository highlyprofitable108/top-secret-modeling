<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f8f9fa;
      }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css" rel="stylesheet">
    <title>Top Secret Modeling</title>
  </head>     
  <body>

    <nav class="bg-gray-800 p-4">
      <div class="container mx-auto flex justify-between items-center">
        <a class="text-white text-xl font-bold" href="/">Top Secret Modeling</a>
        <div class="flex space-x-4">
          <a class="text-white" href="/">Home</a>
          <!-- Additional links can be added here with the same classes as the Home link -->
        </div>
      </div>
    </nav>

    <div class="container mx-auto mt-5 bg-white p-8 rounded-lg shadow-md">
      <div class="mb-8">
        <h5 class="font-bold mb-2 text-gray-800">Active Constants:</h5>
        <p class="text-gray-700">
          {% if active_constants %}
            {{ active_constants|join(', ') }}
          {% else %}
            None
          {% endif %}
        </p>
      </div>
    
      <div class="bg-gray-100 p-4 rounded shadow-md mb-4">
        <h5 class="font-bold text-gray-800">Currently Selected Columns:</h5>
        <p id="selectedColumnsList" class="text-gray-700">None</p>
      </div>

      <h1 class="text-2xl font-bold text-gray-800 mb-4">Select Columns</h1>
      <div class="mb-3">
        <input type="text" class="form-control p-2 rounded border border-gray-300 w-full" id="searchInput" placeholder="Search columns...">
      </div>
      <form action="/process_columns" method="POST">
        <div class="mb-3 flex space-x-2">
          <button type="button" class="bg-gray-800 text-white py-2 px-4 rounded" id="selectAll">Select All</button>
          <button type="button" class="bg-gray-800 text-white py-2 px-4 rounded" id="selectRandom">Random Selection</button>
          <button type="button" class="bg-gray-800 text-white py-2 px-4 rounded" id="clearSelection">Clear Selection</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {% for category, columns in categorized_columns.items() %}
            <div class="bg-white p-4 rounded shadow-md">
              <div class="font-bold text-gray-800 mb-2">
                {{ category }}
              </div>
              <div class="space-y-2">
                {% for column in columns %}
                  <div class="flex items-center space-x-2">
                    <input class="form-check-input column-checkbox" type="checkbox" name="columns" value="{{ column }}" id="{{ column }}">
                    <label class="form-check-label text-gray-700" for="{{ column }}">
                      {{ column.split('.')[-1] }}
                    </label>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
        <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded mt-3">Submit</button>
      </form>
    </div>

    <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded fixed bottom-4 right-4 z-50" onclick="document.querySelector('form').submit();">Submit</button>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        // Get references to DOM elements
        const selectedColumnsList = document.getElementById('selectedColumnsList');
        const checkboxes = document.querySelectorAll('.column-checkbox');
        const selectAllButton = document.getElementById('selectAll');
        const selectRandomButton = document.getElementById('selectRandom');
        const submitButton = document.querySelector('.submit-button');
        const form = document.querySelector('form');
    
        // Add event listener to update the list of selected columns whenever a checkbox is changed
        checkboxes.forEach(checkbox => {
          checkbox.addEventListener('change', () => {
            updateSelectedColumnsList();
          });
        });
    
        // Add event listener to select all checkboxes when the "Select All" button is clicked
        selectAllButton.addEventListener('click', () => {
          checkboxes.forEach(checkbox => {
            checkbox.checked = true;
          });
          updateSelectedColumnsList();
        });
    
        // Add event listener to select a random number of checkboxes when the "Random Selection" button is clicked
        selectRandomButton.addEventListener('click', () => {
          const randomCount = Math.floor(Math.random() * checkboxes.length);
          checkboxes.forEach(checkbox => {
            checkbox.checked = false;
          });
          for (let i = 0; i < randomCount; i++) {
            const randomIndex = Math.floor(Math.random() * checkboxes.length);
            checkboxes[randomIndex].checked = true;
          }
          updateSelectedColumnsList();
        });
    
        // Add event listener to submit the form when the floating submit button is clicked
        submitButton.addEventListener('click', () => {
          form.submit();
        });
    
        // Function to update the list of selected columns
        function updateSelectedColumnsList() {
          const selectedColumns = [];
          checkboxes.forEach(box => {
            if (box.checked) {
              selectedColumns.push(box.value.split('.').pop());
            }
          });
          selectedColumnsList.textContent = selectedColumns.join(', ') || 'None';
        }
      });
    
      // Add event listener to clear all selections when the "Clear Selection" button is clicked
      document.getElementById('clearSelection').addEventListener('click', function() {
        document.querySelectorAll('.form-check-input').forEach(function(checkbox) {
          checkbox.checked = false;
        });
        document.getElementById('selectedColumnsList').textContent = 'None';
      });
    </script>    
  </body>
</html>
