<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>NFL Data Analysis</title>
        
        <!-- Favicon 
        <link rel="icon" href="path_to_your_favicon.ico" type="image/x-icon">
        -->

        <!-- SEO Meta Tags -->
        <meta name="description" content="Interactive analysis and visualization of NFL data.">
        <meta name="keywords" content="NFL, Data Analysis, Visualization, Statistics">
        
        <!-- CSS Libraries -->
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
        
        <style>
            body {
                font-family: 'Roboto', sans-serif;
                background-color: #f8f9fa;
            }
            .tooltip {
                position: relative;
                display: inline-block;
                cursor: pointer;
            }
            .tooltip .tooltiptext {
                visibility: hidden;
                width: 120px;
                background-color: #555;
                color: #fff;
                text-align: center;
                border-radius: 5px;
                padding: 5px;
                position: absolute;
                z-index: 1;
                left: 50%;
                margin-left: -60px;
                opacity: 0;
                transition: opacity 0.3s;
            }
            .tooltip:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
            }
            .csv-content {
                max-height: 300px;
                overflow-y: scroll;
                border: 1px solid #ccc;
                padding: 10px;
                margin-bottom: 20px;
            }
            .tab-button {
                padding: 10px 20px;
                border: none;
                background-color: #f8f9fa;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            .tab-button:hover {
                background-color: #e2e6ea;
            }

            .tab-button.active {
                background-color: #d1d5db;
            }

            .download-btn {
                display: inline-block;
                padding: 10px 20px;
                background-color: #4CAF50;
                color: white;
                text-decoration: none;
                border-radius: 5px;
                transition: background-color 0.3s;
            }

            .download-btn:hover {
                background-color: #45a049;
            }

            .scrollable-table {
                overflow-x: auto;
            }

            .csv-content thead th {
                position: sticky;
                top: 0;
                background-color: white;
                z-index: 10;
            }

        </style>

        <!-- Include Plotly.js for interactive plots -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    </head>
    <body>

        <nav class="bg-gray-800 p-4 sticky top-0 z-50">
            <div class="container mx-auto">
                <a class="text-white text-xl font-bold" href="/">Home</a>
                <div class="flex space-x-4">
                    <a class="text-white" href="/columns">Columns</a>
                    <a class="text-white" href="/generate_analysis">Generate Analysis</a>
                </div>
            </div>
        </nav>

        <div class="container mx-auto mt-5 bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Analysis Results</h2>
            
            <!-- Tabs for different sections -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('heatmap')">Correlation Heatmap</button>
                <button class="tab-button" onclick="showTab('importance')">Feature Importance</button>
                <button class="tab-button" onclick="showTab('statistics')">Descriptive Statistics</button>
                <button class="tab-button" onclick="showTab('quality')">Data Quality Report</button>
            </div>

            <!-- Tab content for Correlation Heatmap -->
            <div id="heatmap" class="tab-content">
                <iframe src="{{ data.heatmap_path }}" width="100%" height="500px"></iframe>
            </div>

            <!-- Tab content for Feature Importance -->
            <div id="importance" class="tab-content hidden">
                <iframe src="{{ data.feature_importance_path }}" width="100%" height="500px"></iframe>
            </div>

            <!-- Tab content for Descriptive Statistics -->
            <div class="scrollable-table">
                <div id="statistics" class="tab-content hidden">
                    <div id="statistics-table"></div>
                    <a href="{{ data.descriptive_stats_path }}" download>Download Descriptive Statistics CSV</a>
                </div>
            </div>

            <!-- Tab content for Data Quality Report -->
            <div id="quality" class="tab-content hidden">
                <div id="quality-table"></div>
                <a href="{{ data.data_quality_report_path }}" download>Download Data Quality Report CSV</a>
            </div>

        </div>

        <footer class="bg-gray-800 text-white py-4 text-center">
            <p class="font-semibold">&copy; 2023 NFL Data Analysis</p>
        </footer>
        
        <script>
            function showTab(tabName) {
                // Hide all tab contents
                let tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(tab => {
                    tab.classList.add('hidden');
                });

                // Deactivate all tab buttons
                let tabButtons = document.querySelectorAll('.tab-button');
                tabButtons.forEach(button => {
                    button.classList.remove('active');
                });

                // Show the selected tab content and activate the button
                document.getElementById(tabName).classList.remove('hidden');
                document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
            }

            function parseCSV(csv) {
                const lines = csv.split("\n");
                let result = [];
                const headers = lines[0].split(",");
                for (let i = 1; i < lines.length; i++) {
                    const obj = {};
                    const currentline = lines[i].split(",");
                    for (let j = 0; j < headers.length; j++) {
                        obj[headers[j]] = currentline[j];
                    }
                    result.push(obj);
                }
                return result;
            }

            function displayCSV(data, elementId) {
                const table = document.createElement('table');
                table.classList.add('csv-content');
                const thead = document.createElement('thead');
                const tbody = document.createElement('tbody');
                table.appendChild(thead);
                table.appendChild(tbody);

                // Headers
                const headers = Object.keys(data[0]);
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);

                // Data
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    headers.forEach(header => {
                        const td = document.createElement('td');
                        td.textContent = row[header];
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                document.getElementById(elementId).appendChild(table);
            }

            fetch('{{ data.descriptive_stats_path }}')
                .then(response => response.text())
                .then(data => {
                    const parsedData = parseCSV(data);
                    displayCSV(parsedData, 'statistics-table');
                });

            fetch('{{ data.data_quality_report_path }}')
                .then(response => response.text())
                .then(data => {
                    const parsedData = parseCSV(data);
                    displayCSV(parsedData, 'quality-table');
                });

        </script>                 
        
    </body>
</html>
